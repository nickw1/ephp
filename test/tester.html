<!DOCTYPE html>
<html>
<head>
<script type='text/javascript' src='../php/js/DebugMgr.js'></script>
<script type='text/javascript' src='../jslib/PromiseAjax.js'></script>
<script type='text/javascript'>

function init() {
	document.getElementById("go").addEventListener("click", go);
}

function go() {

	var artists = ["The+Beatles","Elvis+Presley","Cliff+Richard","Westlife","Madonna","Take+That","Spice+Girls","ABBA","Oasis","The+Rolling+Stones","The+Black+Eyed+Peas","McFly","Blondie","U2","Boyzone","Robbie+Williams","Rod+Stewart","Slade","Kylie+Minogue","Michael+Jackson"];
	var dbgMgrs = [];

	var handlr = new Handlr();

	var limit = parseInt(document.getElementById("limit").value);

	for(var i=0; i<artists.length; i++) {
		if(i<limit) {
			setTimeout((function(i) {
				var user = "ephp" + ("00"+(i+1)).slice(-3);
				handlr.handle("Launching "+ user);
				dbgMgrs[i] = new DebugMgr('../php/launcher.php?XDEBUG_SESSION_STOP',
					{dbgMsgHandler: handlr, overrideUser: user });
				dbgMgrs[i].launchDebugSession('/epup/'+user+'/basicsearch.php?artist='+artists[i], 'GET', null, (xhr) => { handlr.handle("Launch debug return: " + xhr.responseText); } );	
			}).bind(this, i), i*500);
		}
	}

}

function Handlr() {

}

Handlr.prototype.handleLine = function(data) {
	console.log("*******************handleLine()");
	this.handle("handleLine(): " + JSON.stringify(data));
}

Handlr.prototype.handleNewRow = function(data) {
	this.handle("handleNewRow(): " + JSON.stringify(data));
}

Handlr.prototype.handleStdout = function(data) {
	this.handle("handleStdout(): " + JSON.stringify(data));
}

Handlr.prototype.handleDBResults = function (data) {
	this.handle("handleDBResults(): " + JSON.stringify(data));
}

Handlr.prototype.handle = function (str) {
	document.getElementById("output").innerHTML += str + "<br />";
}

Handlr.prototype.clearQueue = function() { }
Handlr.prototype.addToQueue = function(msg) {
}
Handlr.prototype.handleStop = function() { 
	this.handle("STOP");
}

</script>


</head>
<body onload='init()'>

<div>
Limit:
<input id="limit" value="10" />
<input type='button' id='go' value='go' />
</div>

<div id='output' style='width: 1024px; height:768px; overflow:auto; font-family: monospace'></div>

</body>
</html>
